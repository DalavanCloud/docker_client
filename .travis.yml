language: cpp
compiler:
- gcc
before_install:
- if [ "$CXX" == "g++" ]; then sudo add-apt-repository -y ppa:ubuntu-toolchain-r/test; fi
- sudo apt-get update -qq
- export TRAVIS_COMMIT_MSG="$(git log --format=%B --no-merges -n 1)"
install:
- if [[ "$TRAVIS_COMMIT_MSG" = "$COMMIT_IGNORE_BUILD" ]]; then exit 0 ; fi
- if [ "$CXX" == "g++" ]; then sudo apt-get install -qq g++-4.8; fi
- if [ "$CXX" == "g++" ]; then sudo update-alternatives --install /usr/bin/g++ g++ /usr/bin/g++-4.8 50; fi
- wget http://www.biicode.com/downloads/latest/ubuntu64
- mv ubuntu64 bii-ubuntu64.deb
- sudo dpkg -i bii-ubuntu64.deb && sudo apt-get -f install
- rm bii-ubuntu64.deb
- wget https://s3.amazonaws.com/biibinaries/thirdparty/cmake-3.0.2-Linux-64.tar.gz
- tar -xzf cmake-3.0.2-Linux-64.tar.gz
- sudo cp -fR cmake-3.0.2-Linux-64/* /usr
- rm -rf cmake-3.0.2-Linux-64
- rm cmake-3.0.2-Linux-64.tar.gz
- export TRAVIS_CXX=$CXX
script:
# Deploy key, generated with encrypt-file ~/.ssh/id_rsa_xxxx --add (and renaming file to deploy_key.env)
- openssl aes-256-cbc -K $encrypted_7d3b40702ffc_key -iv $encrypted_7d3b40702ffc_iv
  -in deploy_key.enc -out ~\/.ssh/deploy_key -d
- ssh-add ~\/.ssh/deploy_key
- git config --global user.email "$USER_EMAIL"
- git config --global user.name "$USER_NAME"
- echo "$TRAVIS_COMMIT_MSG"
- if [[ "$TRAVIS_COMMIT_MSG" = "$COMMIT_IGNORE_BUILD" ]]; then exit 0 ; fi
- cmake --version
- cd /tmp
- bii init biicode_project
- mkdir -p ./biicode_project/blocks/$USER/$BLOCK_NAME
- cd biicode_project/blocks/$USER/$BLOCK_NAME
- shopt -s dotglob && mv $TRAVIS_BUILD_DIR/* ./
- if [ "$CXX" == "clang++" ]; then export CXX="clang++" && bii cpp:build; fi
- if [ "$CXX" == "g++" ];     then export CXX="g++"     && bii cpp:build; fi
- cd /tmp/biicode_project
- ls ./bin/lasote_docker_client_example_main
after_success:
- bii user $USER -p $BII_PASSWORD
- if [[ -n $TRAVIS_TAG ]]; then 
    bii publish -r --tag STABLE --versiontag $TRAVIS_TAG ||
    echo "Ignored publish output...";
  fi
- if [[ -z $TRAVIS_TAG ]]; then 
    bii publish -r || 
    echo "Ignored publish output...";
  fi
- cd /tmp/biicode_project/blocks/$USER/$BLOCK_NAME
#- if [[ -n $(git status --porcelain) ]]; then 
- git commit -am "$COMMIT_IGNORE_BUILD" && 
  git push ; 
#  fi
env:
  global:
  - USER_EMAIL=lasote@gmail.com
  - USER_NAME="Luis Martinez de Bartolome"
  - COMMIT_IGNORE_BUILD="Promoted version.***travis***"
  - BLOCK_NAME=docker_client
  - USER=lasote
  - secure: K4oI72CcIcUBo3cb7DfhPoWSOEZxNzx8JOLpkZ/xOy3vFvXatvDP1KEpDvpirIGkueBuzhzMXXWE1wsefsbimh1PWSE5iyyF52aoWGuhKsjXt0/q80G2uwA/lcJIRJhJCH0m7QAsG8j054x06A+CJUHOsYCNKK3XUzE5ice+Dsc=
